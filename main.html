<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xml:lang="en" > 
<head> 
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" /> 
        <meta http-equiv="Content-Type" content="application/xhtml+xml" />  
        <style>
		body {
			font-family: Arial, Verdana;
			font-family: Verdana, Arial, Helvetica;
			font-size: 11px;
			color: #000;
			padding: 10px;
			width: 200px;
			line-height: 1.35em;
		}
		a {
			text-decoration: none;
			color: #97CEEC;
		}
		a:hover {
			text-decoration: underline;
		}
		span {
			font-weight: bold;
		}
		</style>
        <script src="sha512.js" type="text/javascript"></script> 
</head> 
<body> 
	<div id="main">	</div>
	<script type="text/javascript">
		var catjs, colorjs, cryptojs, jqueryjs, seedrandomjs, welcomejs, stylecss, hash;
		var verified = 0;
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://raw.github.com/kaepora/cryptocat/master/js/cat.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			catjs = shaObj.getHash("SHA-512", "HEX");
			catjs = String(catjs).replace(/^\s+|\s+$/g,"");
		  }
		}
		xhr.send();

		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://crypto.cat/js/cat.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			hash = shaObj.getHash("SHA-512", "HEX");
			hash = String(hash).replace(/^\s+|\s+$/g,"");
			if (hash == catjs) {
				verified++;
			}
		  }
		}
		xhr.send();
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://raw.github.com/kaepora/cryptocat/master/js/color.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			colorjs = shaObj.getHash("SHA-512", "HEX");
		  }
		}
		xhr.send();
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://crypto.cat/js/color.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			hash = shaObj.getHash("SHA-512", "HEX");
			if (hash == colorjs) {
				verified++;
			}
		  }
		}
		xhr.send();
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://raw.github.com/kaepora/cryptocat/master/js/crypto.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			cryptojs = shaObj.getHash("SHA-512", "HEX");
		  }
		}
		xhr.send();
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://crypto.cat/js/crypto.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			hash = shaObj.getHash("SHA-512", "HEX");
			if (hash == cryptojs) {
				verified++;
			}
		  }
		}
		xhr.send();
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://raw.github.com/kaepora/cryptocat/master/js/jquery.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			jqueryjs = shaObj.getHash("SHA-512", "HEX");
		  }
		}
		xhr.send();
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://crypto.cat/js/jquery.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			hash = shaObj.getHash("SHA-512", "HEX");
			if (hash == jqueryjs) {
				verified++;
			}
		  }
		}
		xhr.send();
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://raw.github.com/kaepora/cryptocat/master/js/seedrandom.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
		 	seedrandomjs = shaObj.getHash("SHA-512", "HEX");
		  }
		}
		xhr.send();
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://crypto.cat/js/seedrandom.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			hash = shaObj.getHash("SHA-512", "HEX");
			if (hash == seedrandomjs) {
				verified++;
			}
		  }
		}
		xhr.send();
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://raw.github.com/kaepora/cryptocat/master/js/welcome.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			welcomejs = shaObj.getHash("SHA-512", "HEX");
		  }
		}
		xhr.send();
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://crypto.cat/js/welcome.js", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			hash = shaObj.getHash("SHA-512", "HEX");
			if (hash == welcomejs) {
				verified++;
			}
		  }
		}
		xhr.send();
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://raw.github.com/kaepora/cryptocat/master/css/style.css", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			stylecss = shaObj.getHash("SHA-512", "HEX");
		  }
		}
		xhr.send();
	
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://crypto.cat/css/style.css", false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
		    var shaObj = new jsSHA(xhr.responseText, "ASCII");
			hash = shaObj.getHash("SHA-512", "HEX");
			if (hash == stylecss) {
				verified++;
			}
		  }
		}
		xhr.send();
		
		function randomEnough() {
			var chars = "0123456789abcdefghiklmnopqrstuvwxyz";
			var string_length = 16;
			var randomstring = '';
			for (var i=0; i<string_length; i++) {
				var rnum = Math.floor(Math.random() * chars.length);
				randomstring += chars.substring(rnum,rnum+1);
			}
			return randomstring;
		}
		
		var x = randomEnough();
		var match;
		var matches = 0;
		var xhr = new XMLHttpRequest();
		xhr.open("GET", "https://crypto.cat/?c=" + x, false);
		xhr.onreadystatechange = function() {
		  if (xhr.readyState == 4) {
			    if (match = xhr.responseText.match("<script type=\"text/javascript\" src=\"js/jquery.js\"><\/script>")) {
					matches++;
				}
				if (match = xhr.responseText.match("<script type=\"text/javascript\" src=\"js/cat.js\"><\/script>")) {
					matches++;
				}
				if (match = xhr.responseText.match("<script type=\"text/javascript\" src=\"js/color.js\"><\/script>")) {
					matches++;
				}
				if (match = xhr.responseText.match("<script type=\"text/javascript\" src=\"js/seedrandom.js\"><\/script>")) {
					matches++;
				}
				if (match = xhr.responseText.match("<script type=\"text/javascript\" src=\"js/crypto.js\"><\/script>")) {
					matches++;
				}
				if (match = xhr.responseText.match(/<script type=\"text\/javascript\">function StuffSelect\(id\) \{document\.getElementById\(id\)\.focus\(\)\;document\.getElementById\(id\).select\(\)\;}\<\/script\>/)) {
					matches++;
				}
				if (match = xhr.responseText.match("<script type=\"text/javascript\">var install = \"https://crypto.cat/\";var update = \"1500\";var name = \"" + x +"\";var maxinput = \"256\";<\/script>")) {
					matches++;
				}
				if (match = xhr.responseText.match(/onclick\=\"StuffSelect\(\'url\'\)\;\"/)) {
					matches++;
				}
				if (match = xhr.responseText.match(/onclick\=\"StuffSelect\(\'key\'\)\;\"/)) {
					matches++;
				}
				if (match = xhr.responseText.match(/onclick\=\"logout\(\)\;\"/)) {
					matches++;
				}
				if (match = xhr.responseText.match(/onkeyup\=\"keytime\(\)\;\"/)) {
					matches++;
				}
				if (match = xhr.responseText.match(/\<meta http-equiv\=\"Content-Type\" content\=\"application\/xhtml\+xml\" \/\>/)) {
					matches++;
				}
				if (match = xhr.responseText.match(/\<link rel\=\"stylesheet\" href\=\"css\/style.css\" type\=\"text\/css\" \/\>/)) {
					matches++;
				}
				if (match = xhr.responseText.match(/\<link rel\=\"icon\" type\=\"image\/png\" href\=\"img\/favicon.gif\" \/\>/)) {
					matches++;
				}
				if (match = xhr.responseText.match(/\<input type\=\"text\" name\=\"input\" id\=\"input\" maxlength\=\"256\" onkeydown\=\"textcounter\(document\.chatform\.input\,document\.chatform\.talk\,256\)\" onkeyup\=\"textcounter\(document\.chatform\.input\,document\.chatform\.talk\,256\)\" autocomplete\=\"off\" \/\>\<input type\=\"submit\" name\=\"talk\" id\=\"talk\" onmouseover\=\"curcount \= this\.value\; this\.value\=\'send\'\;\" onmouseout\=\"this\.value\=curcount\;\" value\=\"256\" \/\>/)) {
					matches++;
				}
				if (match = xhr.responseText.match(/\<script.+/g)) {
					if (match.length > 7) {
						matches = 0;
					}
				}
				if (match = xhr.responseText.match(/onload|onunload|onblur|onchange|onfocus|onreset|onselect|onsubmit|onabort|onkey|ondblclick|onclick|onmouse|applet|embed|object|meta|style|link/g)) {
					if (match.length > 13) {
						matches = 0;
					}
				}
				if (match = xhr.responseText.match(/frame/g)) {
					if (match.length > 1) {
						matches = 0;
					}
				}
			}
		}
		xhr.send();
		
		if (verified === 7 && matches === 15) {
			document.getElementById("main").innerHTML = "<span>Integrity check passed.</span><br /><a target=\"_blank\" href=\"https://crypto.cat\">Open Cryptocat</a><br />";
		}
		else {
			document.getElementById("main").innerHTML = "<span style=\"color:#F00\">Integrity check failed.</span><br />Clear your browser cache and try again. Should the problem persist, your Cryptocat session may be unsafe.";
		}
	</script>
</body> 
</html>